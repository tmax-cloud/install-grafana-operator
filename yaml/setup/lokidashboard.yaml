apiVersion: v1
data:
  lokidashboard.json: |-    
            {
              "annotations": {
                "list": [
                  {
                    "builtIn": 1,
                    "datasource": "-- Grafana --",
                    "enable": true,
                    "hide": true,
                    "iconColor": "rgba(0, 211, 255, 1)",
                    "name": "Annotations & Alerts",
                    "target": {
                      "limit": 100,
                      "matchAny": false,
                      "tags": [],
                      "type": "dashboard"
                    },
                    "type": "dashboard"
                  }
                ]
              },
              "description": "loki dashboard with quick search and timeline.",
              "editable": true,
              "fiscalYearStartMonth": 0,
              "gnetId": 13186,
              "graphTooltip": 0,
              "id": 79,
              "iteration": 1667979423141,
              "links": [],
              "liveNow": false,
              "panels": [
                {
                  "datasource": "loki",
                  "fieldConfig": {
                    "defaults": {
                      "color": {
                        "mode": "continuous-GrYlRd"
                      },
                      "custom": {
                        "axisLabel": "",
                        "axisPlacement": "hidden",
                        "barAlignment": 0,
                        "drawStyle": "bars",
                        "fillOpacity": 100,
                        "gradientMode": "none",
                        "hideFrom": {
                          "legend": false,
                          "tooltip": false,
                          "viz": false
                        },
                        "lineInterpolation": "linear",
                        "lineWidth": 0,
                        "pointSize": 5,
                        "scaleDistribution": {
                          "type": "linear"
                        },
                        "showPoints": "never",
                        "spanNulls": true,
                        "stacking": {
                          "group": "A",
                          "mode": "none"
                        },
                        "thresholdsStyle": {
                          "mode": "off"
                        }
                      },
                      "links": [],
                      "mappings": [],
                      "thresholds": {
                        "mode": "absolute",
                        "steps": [
                          {
                            "color": "green",
                            "value": null
                          },
                          {
                            "color": "red",
                            "value": 80
                          }
                        ]
                      },
                      "unit": "short"
                    },
                    "overrides": []
                  },
                  "gridPos": {
                    "h": 7,
                    "w": 24,
                    "x": 0,
                    "y": 0
                  },
                  "id": 6,
                  "options": {
                    "legend": {
                      "calcs": [],
                      "displayMode": "hidden",
                      "placement": "bottom"
                    },
                    "tooltip": {
                      "mode": "single"
                    }
                  },
                  "pluginVersion": "8.2.2",
                  "targets": [
                    {
                      "expr": "sum(count_over_time({namespace=\"$namespace\", pod_name=~\"$pod_name\"} |~ \"$search\"[$__interval]))",
                      "legendFormat": "total num of logs",
                      "refId": "A"
                    }
                  ],
                  "timeFrom": null,
                  "timeShift": null,
                  "title": "Timeline",
                  "type": "timeseries"
                },
                {
                  "datasource": "loki",
                  "gridPos": {
                    "h": 25,
                    "w": 24,
                    "x": 0,
                    "y": 7
                  },
                  "id": 2,
                  "maxDataPoints": "",
                  "options": {
                    "dedupStrategy": "none",
                    "enableLogDetails": true,
                    "prettifyLogMessage": false,
                    "showCommonLabels": false,
                    "showLabels": true,
                    "showTime": true,
                    "sortOrder": "Descending",
                    "wrapLogMessage": true
                  },
                  "targets": [
                    {
                      "expr": "{namespace=\"$namespace\",pod_name=~\"$pod_name\"} |~ \"$search\"",
                      "refId": "A"
                    }
                  ],
                  "timeFrom": null,
                  "timeShift": null,
                  "title": "Logs",
                  "type": "logs"
                }
              ],
              "refresh": false,
              "schemaVersion": 31,
              "style": "dark",
              "tags": [],
              "templating": {
                "list": [
                  {
                    "current": {
                      "selected": false,
                      "text": "loki",
                      "value": "loki"
                    },
                    "description": null,
                    "error": null,
                    "hide": 0,
                    "includeAll": false,
                    "label": null,
                    "multi": false,
                    "name": "loki",
                    "options": [],
                    "query": "loki",
                    "queryValue": "",
                    "refresh": 1,
                    "regex": "",
                    "skipUrlSync": false,
                    "type": "datasource"
                  },
                  {
                    "allValue": ".*",
                    "current": {
                      "selected": false,
                      "text": "",
                      "value": ""
                    },
                    "datasource": "loki",
                    "definition": "label_values({namespace=\"$namespace\"}, pod_name)",
                    "description": null,
                    "error": null,
                    "hide": 0,
                    "includeAll": true,
                    "label": null,
                    "multi": false,
                    "name": "pod_name",
                    "options": [],
                    "query": "label_values({namespace=\"$namespace\"}, pod_name)",
                    "refresh": 1,
                    "regex": "",
                    "skipUrlSync": false,
                    "sort": 0,
                    "tagValuesQuery": "",
                    "tagsQuery": "",
                    "type": "query",
                    "useTags": false
                  },
                  {
                    "current": {
                      "selected": true,
                      "text": "",
                      "value": ""
                    },
                    "description": null,
                    "error": null,
                    "hide": 0,
                    "label": null,
                    "name": "search",
                    "options": [
                      {
                        "selected": true,
                        "text": "",
                        "value": ""
                      }
                    ],
                    "query": "",
                    "skipUrlSync": false,
                    "type": "textbox"
                  }
                ]
              },
              "time": {
                "from": "now-1h",
                "to": "now"
              },
              "timepicker": {
                "refresh_intervals": [
                  "10s",
                  "30s",
                  "1m",
                  "5m",
                  "15m",
                  "30m",
                  "1h",
                  "2h",
                  "1d"
                ]
              },
              "timezone": "",
              "title": "$namespace log dashboard",
              "uid": "log-$namespace",
              "version": 1 
            }
kind: ConfigMap
metadata:
  name: loki-dashboard
  namespace: monitoring

